
### 什么是ARP协议
ARP（Address ResoluTIon Protocol）,即地址解析协议,是根据IP地址获取物理地址的一个TCP/IP协议。主机发送信息时将包含目标IP地址的ARP请求广播到网络上的所有主机，并接收返回消息，以此确定目标的物理地址；收到返回消息后将该IP地址和物理地址存入本机ARP缓存中并保留一定时间，下次请求时直接查询ARP缓存以节约资源。

地址解析协议是建立在网络中各个主机互相信任的基础上的，网络上的主机可以自主发送ARP应答消息，其他主机收到应答报文时不会检测该报文的真实性就会将其记入本机ARP缓存；由此攻击者就可以向某一主机发送伪ARP应答报文，使其发送的信息无法到达预期的主机或到达错误的主机，这就构成了一个ARP欺骗。

### 怎么查看自己的MAC地址
依次单击“开始”→“运行”→输入“CMD”→回车→输入“ipconfig /all”→回车。即可看到MAC地址。由16进制的编号做成,这就是物理地址我们简称MAC地址,该物理地址是全球唯一的,因为他随着网卡出厂后就已编写固定了(当然这个也是可以通过软件伪造MAC地址的,这里就不过多讲解了)。    

或者使用`arp -a`命令根据自己主机ip查看对应的mac地址
```
物理地址. . . . . . . . . . . . . : XXXXX
```
>ARP命令可用于查询本机ARP缓存中IP地址和MAC地址的对应关系、添加或删除静态对应关系等。

### ARP协议的缺陷
　　ARP协议是建立在信任局域网内所有结点的基础上的，它很高效，但却不安全。它是无状态的协议，不会检查自己是否发过请求包，也不管（其实也不知道）是否是合法的应答，只要收到目标MAC是自己的ARP reply包或arp广播包（包括ARP request和ARP reply），都会接受并缓存。这就为ARP欺骗提供了可能，恶意节点可以发布虚假的ARP报文从而影响网内结点的通信，甚至可以做“中间人”。

### ARP协议的漏洞
ARP主要是利用伪造的IP/MAC映射关系来欺骗取局域网络内其他主机的信任,从而达到非法截取网络内其他主机之间的通信数据。ARP协议的安全漏洞来源于协议本身设计的不足，ARP 协议被设计成一种可信任协议。缺乏合法验证手段

ARP协议具有广播性、无状态性、无认证、无关性和动态性等一系列安全缺陷

#### 1.广播性
ARP协议寻找MAC地址是广播方式的,攻击者可以应答错误的MAC地址,同时攻击者也可以不间断的发起广播ARP请求包(通过wireshark可以查看到局域网内某一IP不间断的发起255.255.255.255广播包),造成网络的缓慢甚至堵塞。

#### 2.无状态性和动态性
任意主机都可以在没有请求的情况下进行应答,且任何主机只要收到网络内正确的ARP应答包,不管它本身是否有ARP请求,都会无条件的更新缓存表(arp -a查看动态和静态)。

#### 3.无认证
ARP协议默认情况下是信任网络内的所有节点，只要是存在ARP缓存表里的IP/MAC映射以及接收到的ARP应答中的IP/MAC映射关系,ARP都认为是可信任的,并没有对IP/MAC映射的真实性,进行有效性进行检验,也没有维护映射的一致性。

### 常见ARP欺骗攻击形式
**1.假冒ARP reply包（单播）**  
    XXX，I have IP YYY and my MAC is ZZZ！

**2.假冒ARP reply包（广播）**   
    Hello everyone！ I have IP YYY and my MAC is ZZZ！

    向所有人散布虚假的IP/MAC

**3.假冒ARP request（广播）**  
    I have IP XXX and my MAC is YYY.

    Who has IP ZZZ？ tell me please！

    表面为找IP ZZZ的MAC，实际是广播虚假的IP、MAC映射（XXX，YYY）

**4.假冒ARP request（单播）**   
    已知IP ZZZ的MAC

    Hello IP ZZZ！ I have IP XXX and my MAC is YYY.

**5.假冒中间人**    
    欺骗主机（MAC为MMM）上启用包转发

    向主机AAA发假冒ARP Reply：

    AAA，I have IP BBB and my MAC is MMM，

    向主机BBB发假冒ARP Reply：

    BBB，I have IP AAA and my MAC is MMM

    由于ARP Cache的老化机制，有时还需要做周期性连续欺骗。

### 怎么发现自己是否收到了ARP攻击
如果网络受到了ARP攻击，可能会出现如下现象：
1. 用户掉线、频繁断网、上网慢、业务中断或无法上网。
2. 设备CPU占用率较高、设备托管、下挂设备掉线、设备主备状态震荡、设备端口指示灯红色快闪。
3. Ping有时延、丢包或不通。

通过`arp -a` 命令查看使用的网关IP地址所对应的MAC地址。如果查到的地址和正常情况下的MAC地址不一样，那么就可以确定是受到了arp网关欺骗。

### ARP攻击的解决办法
在DOS命令行下输入`arp -d`清除缓存，再输入`arp -a`,现在基本上开启了防火墙的话都能防御住arp攻击。

### 知识扩展
ARP攻击是从**数据链路层**(交换机)发起的，而ARP防火墙、360等都是**应用层**软件，防不了的。并且ARP等网络攻击一直都存在的，网络攻击有时并不是人为故意搞破坏，因为以太网协议存在先天漏洞和难管理的缺陷，导致各种内网问题层出不穷。要想彻底解决内网攻击，只有从每个终端的网卡上进行防控拦截，使其不能发出ARP攻击。360是使用了“免疫墙技术”，将普通网络升级为免疫网络，从网络底层、每个终端上进行防控监测，加固网络基础安全，能够彻底有效的解决内网攻击问题。

>在IPv6体系结构中已经没有ARP协议了,IPv6不使用ARP来检测IP地址和mac地址的对应关系,IPv6利用邻居发现协议来找到这些对应关系。

